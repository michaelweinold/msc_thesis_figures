\documentclass[crop]{standalone}

\usepackage{../../../supplementary/header/header_pgfplot_standalone}

\pgfplotsset{compat=newest,
			xtick pos=left,
			ytick pos=left
			}
			

\begin{document}
\begin{tikzpicture}

\begin{axis}[
	height=220pt,
	width=418pt,
%Type
	bar width=15pt,
	%nodes near coords,
	axis on top,
	enlarge x limits=0.04,
	symbolic x coords={vfe,iqe,droop,lee,ce-red,ce-green,se,pce},
%Domain
	ymin=0,ymax=110,
	xmin=vfe,xmax=pce,
%Axis Labels
    xticklabel style={align=center},
	ylabel=Efficiency \text{[}\%\text{]},
	xticklabels={,V$_\text{f}$E, IQE, Droop, LEE, CE \\ (\textcolor{red}{Red}), CE \\ (\textcolor{teal}{Green}), SE, \textbf{PCE}},
%Legend
    legend style={at={(0.02,0.03)},anchor=south west},
	legend cell align={left},
	legend style={draw=none,fill=white},
	%nodes near coords,
			]
\addlegendimage{/pgfplots/refstyle=bluebar}
\addlegendentry{Spillover}
\addlegendimage{/pgfplots/refstyle=graybar}
\addlegendentry{Other Improvements}
]
%Hidden bar to push other bars to 2003 level
\addplot [ybar stacked,fill=none,draw=none]
	table [col sep=comma, x=losschannel, y=hiddenbar]
	{../data/efficiency_breakthroughs.csv};
%1 OTHER
\addplot [ybar stacked,fill=gray!30,draw=gray]
	table [col sep=comma, x=losschannel, y=o-1]
	{../data/efficiency_breakthroughs.csv}; \label{graybar}
%1 OTHER
\addplot [ybar stacked,fill=blue!30,draw=blue]
	table [col sep=comma, x=losschannel, y=so-1]
	{../data/efficiency_breakthroughs.csv}; \label{bluebar}.
%2 OTHER
\addplot [ybar stacked,fill=gray!30,draw=gray]
	table [col sep=comma, x=losschannel, y=o-2]
	{../data/efficiency_breakthroughs.csv}; \label{graybar}
%2 OTHER
\addplot [ybar stacked,fill=blue!30,draw=blue]
	table [col sep=comma, x=losschannel, y=so-2]
	{../data/efficiency_breakthroughs.csv}; \label{bluebar}
%1 OTHER
\addplot [ybar stacked,fill=gray!30,draw=gray]
	table [col sep=comma, x=losschannel, y=o-3]
	{../data/efficiency_breakthroughs.csv}; \label{graybar}
%1 OTHER
\addplot [ybar stacked,fill=blue!30,draw=blue]
	table [col sep=comma, x=losschannel, y=so-3]
	{../data/efficiency_breakthroughs.csv}; \label{bluebar}
\end{axis}

%Years Legend only
\begin{axis}[
	height=220pt,
	width=418pt,
%Type
	%nodes near coords,
	axis on top,
	enlarge x limits=0.04,
%Domain
	ymin=0,ymax=110,
	xmin=0,xmax=7,
%Axis Labels
	%ylabel=Efficiency \text{[}\%\text{]},
	xticklabels={,,},
%Legend
    legend style={at={(0.01,0.2)},anchor=south west},
	legend cell align={left},
	legend style={draw=none,fill=none},
			]
\addlegendimage{no markers, thick, black}
\addlegendentry{2020}
\addlegendimage{no markers, thick, purple}
\addlegendentry{2016}
\addlegendimage{no markers, thick, red}
\addlegendentry{2010}
\addlegendimage{no markers, thick, orange}
\addlegendentry{2002}
\addlegendimage{no markers, thick, blue}
\addlegendentry{Physical Limit}
]
%Table
\node [above right] at (rel axis cs:0.4,0.03) {\includegraphics[width=180pt]{table.pdf}};
%Annotations
%CE
\node [] at (6.35,73.5) {2};
%VfE
\node [] at (0.35,80) {1};
%Efficiency Lines per Year
%VfE
\draw [orange, thick] (axis cs:-0.25,70) -- (axis cs:0.25,70);
\draw [red, thick] (axis cs:-0.25,85) -- (axis cs:0.25,85);
\draw [purple, thick] (axis cs:-0.25,96) -- (axis cs:0.25,96);
\draw [black, thick] (axis cs:-0.25,99.5) -- (axis cs:0.25,99.5);
\draw[->, blue, thick] (axis cs:0,103) -- (axis cs:0,110);
%IQE
\draw [orange, thick] (axis cs:0.75,55) -- (axis cs:1.25,55);
\draw [red, thick] (axis cs:0.75,70) -- (axis cs:1.25,70);
\draw [purple, thick] (axis cs:0.75,88.02) -- (axis cs:1.25,88.02);
\draw [black, thick] (axis cs:0.75,90) -- (axis cs:1.25,90);
\draw [blue, thick] (axis cs:0.75,100) -- (axis cs:1.25,100);
%Droop
\draw [orange, thick] (axis cs:1.75,65) -- (axis cs:2.25,65);
\draw [red, thick] (axis cs:1.75,70) -- (axis cs:2.25,70);
\draw [purple, thick] (axis cs:1.75,90.06) -- (axis cs:2.25,90.06);
\draw [black, thick] (axis cs:1.75,90.06) -- (axis cs:2.25,90.06);
\draw [blue, thick] (axis cs:1.75,100) -- (axis cs:2.25,100);
%LEE
\draw [orange, thick] (axis cs:2.75,60) -- (axis cs:3.25,60);
\draw [red, thick] (axis cs:2.75,80) -- (axis cs:3.25,80);
\draw [purple, thick] (axis cs:2.75,86.86) -- (axis cs:3.25,86.86);
\draw [black, thick] (axis cs:2.75,90) -- (axis cs:3.25,90);
\draw [blue, thick] (axis cs:2.75,100) -- (axis cs:3.25,100);
%CE(Red)
\draw [orange, thick] (axis cs:3.75,45.265) -- (axis cs:4.25,45.265);
\draw [red, thick] (axis cs:3.75,51.12) -- (axis cs:4.25,51.12);
\draw [purple, thick] (axis cs:3.75,51.12) -- (axis cs:4.25,51.12);
\draw [black, thick] (axis cs:3.75,56) -- (axis cs:4.25,56);
\draw [blue, thick] (axis cs:3.75,70) -- (axis cs:4.25,70);
%CE(Green/Yellow)
\draw [orange, thick] (axis cs:4.75,61) -- (axis cs:5.25,61);
\draw [red, thick] (axis cs:4.75,61) -- (axis cs:5.25,61);
\draw [purple, thick] (axis cs:4.75,79.32398267) -- (axis cs:5.25,79.32398267);
\draw [black, thick] (axis cs:4.75,80) -- (axis cs:5.25,80);
\draw [blue, thick] (axis cs:4.75,91) -- (axis cs:5.25,91);
%SE
\draw [orange, thick] (axis cs:5.75,74) -- (axis cs:6.25,74);
\draw [red, thick] (axis cs:5.75,69.24939467) -- (axis cs:6.25,69.24939467);
\draw [purple, thick] (axis cs:5.75,78.17) -- (axis cs:6.25,78.17);
\draw [black, thick] (axis cs:5.75,83) -- (axis cs:6.25,83);
\draw [blue, thick] (axis cs:5.75,100) -- (axis cs:6.25,100);
\end{axis}

\end{tikzpicture}
\end{document}
